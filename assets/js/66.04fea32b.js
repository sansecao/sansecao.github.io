(window.webpackJsonp=window.webpackJsonp||[]).push([[66],{495:function(s,n,a){"use strict";a.r(n);var e=a(43),t=Object(e.a)({},(function(){var s=this,n=s.$createElement,a=s._self._c||n;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"事务"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#事务"}},[s._v("#")]),s._v(" 事务")]),s._v(" "),a("ol",[a("li",[s._v("什么是事务")])]),s._v(" "),a("p",[s._v("一个事务是一个完整的业务逻辑单元，不可再分eg：银行账户转账，从账户A->账户B转账10000.需要执行update语句")]),s._v(" "),a("p",[s._v("update t_act set balance = balance - 10000 where acino='act-001';")]),s._v(" "),a("p",[s._v("update t_act set balance = balance + 10000 where acino='act-002';")]),s._v(" "),a("p",[s._v("这两项操作只能同时成功和同事失败，不允许一条成功一条失败")]),s._v(" "),a("p",[s._v("要保证以上的两天DML语句同事成功或者失败，那么需要使用数据库的“事务机制”")]),s._v(" "),a("ol",{attrs:{start:"2"}},[a("li",[s._v("和事务相关的语句只有：DML语句。（insert delete update）")])]),s._v(" "),a("p",[s._v("为什么？因为他们这三个语句都是数据库表中的数据相关的")]),s._v(" "),a("p",[s._v("事务的存在是为了保证数据的完整性，安全性")]),s._v(" "),a("ol",{attrs:{start:"3"}},[a("li",[s._v("假设所有的业务都能使用1条DML语句搞定，还需要事务机制吗？不需要，但是显然实际情况不是这样的咯，一个事情（业务）肯定是很容易需要多个DML语句完成的")])]),s._v(" "),a("p",[s._v("事务：TCL（commit、rollback、savepoint）")]),s._v(" "),a("ol",{attrs:{start:"4"}},[a("li",[s._v("事务的特性？ACID")])]),s._v(" "),a("p",[s._v("A:原子性：事务是最小的工作单元")]),s._v(" "),a("p",[s._v("C:一致性：事务必须保证多条DML语句同时成功或者同时失败")]),s._v(" "),a("p",[s._v("I:隔离性：事务A与事务B之间具有隔离")]),s._v(" "),a("p",[s._v("D:持久性：最终数据持久化到硬盘文件中，事务才算成功的结束")]),s._v(" "),a("ol",{attrs:{start:"5"}},[a("li",[s._v("关于事务之间的隔离性")])]),s._v(" "),a("p",[s._v("事务隔离性存在个理级别，理论上隔离级别包括4个：")]),s._v(" "),a("p",[s._v("第一级别：")]),s._v(" "),a("p",[s._v("读未提交（read uncommitted）：对方事务还没有提交，而我就可以读取到未提交的数据了，这种存在脏读现象，表示读到了脏数据")]),s._v(" "),a("p",[s._v("第二级别：")]),s._v(" "),a("p",[s._v("读已提交（read committed）：对方提交之后的数据，我方可以读取，")]),s._v(" "),a("p",[s._v("解决了脏读现象")]),s._v(" "),a("p",[s._v("存在的问题是：不可重复读")]),s._v(" "),a("p",[s._v("第三级别：")]),s._v(" "),a("p",[s._v("可重复读（repeatable read）：")]),s._v(" "),a("p",[s._v("这种级别解决了，不可重复读的问题")]),s._v(" "),a("p",[s._v("这种隔离级别存在的问题：读取到的数据是幻象")]),s._v(" "),a("p",[s._v("第四级别：")]),s._v(" "),a("p",[s._v("序列化读/串行化读")]),s._v(" "),a("p",[s._v("解决了所有问题")]),s._v(" "),a("p",[s._v("存在的问题：效率低，需要事务排队")]),s._v(" "),a("p",[s._v("Oracle数据库默认级别是：读已提交")]),s._v(" "),a("p",[s._v("MySQL数据库默认级别是：可重复读")]),s._v(" "),a("ol",{attrs:{start:"6"}},[a("li",[s._v("演示事务")])]),s._v(" "),a("ul",[a("li",[s._v("mysql事务默认情况下是自动提交。（只要执行任意一条DML语句则提交一次）")])]),s._v(" "),a("p",[s._v("怎么关闭呢？start transaction")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("mysql> create table t_user(\n    -> id int primary key auto_increment,\n    -> username varchar(255)\n    -> );\nQuery OK, 0 rows affected (0.04 sec)\n\nmysql> insert into t_user(username) values('zs');\nQuery OK, 1 row affected (0.02 sec)\n\nmysql> select * from t_user;\n+----+----------+\n| id | username |\n+----+----------+\n|  1 | zs       |\n+----+----------+\n1 row in set (0.00 sec)\n\nmysql> rollback;\nQuery OK, 0 rows affected (0.00 sec)\n\nmysql> select * from t_user;\n+----+----------+\n| id | username |\n+----+----------+\n|  1 | zs       |\n+----+----------+\n1 row in set (0.00 sec)\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br")])]),a("p",[s._v("证明了自动提交")]),s._v(" "),a("ul",[a("li",[s._v("使用start transaction 关闭自动提交，也是再说开始一个事务（之后出现rollback/commit）事务关闭")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("mysql> insert into t_user (username) values('zs1');\nQuery OK, 1 row affected (0.00 sec)\n\nmysql> select * from t_user;\n+----+----------+\n| id | username |\n+----+----------+\n|  1 | zs       |\n|  2 | zs1      |\n+----+----------+\n2 rows in set (0.00 sec)\n\nmysql> insert into t_user (username) values('ls');\nQuery OK, 1 row affected (0.00 sec)\n\nmysql> select * from t_user;\n+----+----------+\n| id | username |\n+----+----------+\n|  1 | zs       |\n|  2 | zs1      |\n|  3 | ls       |\n+----+----------+\n3 rows in set (0.00 sec)\n\nmysql> rollback;\nQuery OK, 0 rows affected (0.02 sec)\n\nmysql> select * from t_user;\n+----+----------+\n| id | username |\n+----+----------+\n|  1 | zs       |\n+----+----------+\n1 row in set (0.00 sec)\n\nmysql> start transaction;\nQuery OK, 0 rows affected (0.00 sec)\n\nmysql> insert into t_user(username) values('zs');\nQuery OK, 1 row affected (0.00 sec)\n\nmysql> insert into t_user(username) values('zs1');\nQuery OK, 1 row affected (0.00 sec)\n\nmysql> insert into t_user(username) values('ls');\nQuery OK, 1 row affected (0.00 sec)\n\nmysql> select * from t_user;\n+----+----------+\n| id | username |\n+----+----------+\n|  1 | zs       |\n|  4 | zs       |\n|  5 | zs1      |\n|  6 | ls       |\n+----+----------+\n4 rows in set (0.00 sec)\n\nmysql> commit;\nQuery OK, 0 rows affected (0.02 sec)\n\nmysql> select * from t_user;\n+----+----------+\n| id | username |\n+----+----------+\n|  1 | zs       |\n|  4 | zs       |\n|  5 | zs1      |\n|  6 | ls       |\n+----+----------+\n4 rows in set (0.00 sec)\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br"),a("span",{staticClass:"line-number"},[s._v("49")]),a("br"),a("span",{staticClass:"line-number"},[s._v("50")]),a("br"),a("span",{staticClass:"line-number"},[s._v("51")]),a("br"),a("span",{staticClass:"line-number"},[s._v("52")]),a("br"),a("span",{staticClass:"line-number"},[s._v("53")]),a("br"),a("span",{staticClass:"line-number"},[s._v("54")]),a("br"),a("span",{staticClass:"line-number"},[s._v("55")]),a("br"),a("span",{staticClass:"line-number"},[s._v("56")]),a("br"),a("span",{staticClass:"line-number"},[s._v("57")]),a("br"),a("span",{staticClass:"line-number"},[s._v("58")]),a("br"),a("span",{staticClass:"line-number"},[s._v("59")]),a("br"),a("span",{staticClass:"line-number"},[s._v("60")]),a("br"),a("span",{staticClass:"line-number"},[s._v("61")]),a("br"),a("span",{staticClass:"line-number"},[s._v("62")]),a("br"),a("span",{staticClass:"line-number"},[s._v("63")]),a("br"),a("span",{staticClass:"line-number"},[s._v("64")]),a("br"),a("span",{staticClass:"line-number"},[s._v("65")]),a("br"),a("span",{staticClass:"line-number"},[s._v("66")]),a("br"),a("span",{staticClass:"line-number"},[s._v("67")]),a("br"),a("span",{staticClass:"line-number"},[s._v("68")]),a("br"),a("span",{staticClass:"line-number"},[s._v("69")]),a("br"),a("span",{staticClass:"line-number"},[s._v("70")]),a("br"),a("span",{staticClass:"line-number"},[s._v("71")]),a("br"),a("span",{staticClass:"line-number"},[s._v("72")]),a("br")])]),a("ul",[a("li",[s._v("设置事务隔离级别： set global transaction isolation level read uncommitted;")]),s._v(" "),a("li",[s._v("查看事务全局的隔离级别：select @@global.tx_isolation;")])])])}),[],!1,null,null,null);n.default=t.exports}}]);